# CyberWaifu Bot

ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ Telegram AI èŠå¤©æœºå™¨äººï¼Œæ”¯æŒå¤šè§’è‰²å¯¹è¯ã€ç¾¤ç»„ç®¡ç†ã€åŠ å¯†è´§å¸åˆ†æã€æ•°æ®åº“ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒç§èŠå’Œç¾¤èŠåœºæ™¯ï¼Œå…·å¤‡å®Œå–„çš„æƒé™ç®¡ç†å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚

**æµ‹è¯•ç‰ˆæœºå™¨äººï¼š** https://t.me/waifucui_bot

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¤– **å¤šè§’è‰² AI å¯¹è¯**ï¼šæ”¯æŒé¢„è®¾å’Œè‡ªå®šä¹‰è§’è‰²ï¼Œè§’è‰²åˆ‡æ¢ï¼Œä¸ªæ€§åŒ–å¯¹è¯ä½“éªŒ
- ğŸ‘¥ **æ™ºèƒ½ç¾¤ç»„ç®¡ç†**ï¼šå…³é”®è¯è§¦å‘ã€å›å¤é¢‘ç‡æ§åˆ¶ã€ç¾¤ç»„è§’è‰²ç®¡ç†
- ğŸ“Š **åŠ å¯†è´§å¸åˆ†æ**ï¼šå®æ—¶è¡Œæƒ…æŸ¥è¯¢ï¼ŒAI é©±åŠ¨çš„å¸‚åœºåˆ†æï¼ˆæ”¯æŒå¤šç©ºå€¾å‘ï¼‰
- ğŸ› ï¸ **LLM å·¥å…·è°ƒç”¨**ï¼šé›†æˆå¤šç§å·¥å…·ï¼Œæ”¯æŒæ•°æ®åº“æŸ¥è¯¢ã€å¸‚åœºåˆ†æç­‰åŠŸèƒ½
- ğŸ¯ **æƒé™ç®¡ç†ç³»ç»Ÿ**ï¼šç”¨æˆ·ç­‰çº§ã€ç®¡ç†å‘˜æƒé™ã€ç¾¤ç»„æƒé™ç²¾ç»†æ§åˆ¶
- ğŸ’¾ **å¯¹è¯æŒä¹…åŒ–**ï¼šå¯¹è¯ä¿å­˜/åŠ è½½ã€å†å²è®°å½•ç®¡ç†
- ğŸ” **å†…è”æŸ¥è¯¢åŠŸèƒ½**ï¼šé€šè¿‡ @botname å¿«é€ŸæŸ¥è¯¢è§’è‰²ã€é¢„è®¾å’Œå¸®åŠ©ä¿¡æ¯
- ğŸŒ **Web ç®¡ç†åå°**ï¼šç”¨æˆ·ç®¡ç†ã€æ•°æ®ç»Ÿè®¡ã€ç³»ç»Ÿç›‘æ§
- ğŸ”§ **é«˜åº¦å¯æ‰©å±•**ï¼šæ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œå‘½ä»¤

## ğŸ“ é¡¹ç›®ç»“æ„

```
cyberwaifu_bot/
â”œâ”€â”€ ğŸ“„ bot_run.py                    # ğŸš€ åº”ç”¨å¯åŠ¨å…¥å£
â”œâ”€â”€ ğŸ“„ Dockerfile                    # ğŸ³ Docker éƒ¨ç½²é…ç½®
â”œâ”€â”€ ğŸ“„ requirements.txt              # ğŸ“¦ Python ä¾èµ–åŒ…
â”œâ”€â”€ ğŸ“„ README.md                     # ğŸ“– é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ ğŸ“ bot_core/                     # ğŸ¤– æœºå™¨äººæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ command_handlers/         # âš¡ å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py              # ğŸ—ï¸ å‘½ä»¤åŸºç±»å’Œå…ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ private.py           # ğŸ‘¤ ç§èŠå‘½ä»¤ï¼ˆè§’è‰²ç®¡ç†ã€å¯¹è¯æ§åˆ¶ã€åŠ å¯†è´§å¸åˆ†æï¼‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ group.py             # ğŸ‘¥ ç¾¤ç»„å‘½ä»¤ï¼ˆç¾¤ç®¡ã€å…³é”®è¯ã€é¢‘ç‡æ§åˆ¶ï¼‰
â”‚   â”‚   â””â”€â”€ ğŸ“„ admin.py             # ğŸ” ç®¡ç†å‘˜å‘½ä»¤ï¼ˆç”¨æˆ·ç®¡ç†ã€æ•°æ®åº“æ“ä½œï¼‰
â”‚   â”œâ”€â”€ ğŸ“ message_handlers/         # ğŸ’¬ æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ private.py           # ğŸ‘¤ ç§èŠæ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ group.py             # ğŸ‘¥ ç¾¤ç»„æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â””â”€â”€ ğŸ“ features/            # ğŸ¯ ç‰¹æ®ŠåŠŸèƒ½ï¼ˆå›¾ç‰‡è¯†åˆ«ã€è§’è‰²åˆ›å»ºç­‰ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ callback_handlers/        # ğŸ”„ å›è°ƒæŸ¥è¯¢å¤„ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ callback.py          # ğŸ›ï¸ å†…è”é”®ç›˜å›è°ƒå¤„ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inline.py            # âŒ¨ï¸ å†…è”é”®ç›˜ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ ğŸ“„ director_classes.py  # ğŸ¬ å¯¼æ¼”æ¨¡å¼ï¼ˆå¤šè§’è‰²å¯¹è¯ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ inline_handlers/          # ğŸ” å†…è”æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py              # ğŸ—ï¸ å†…è”æŸ¥è¯¢åŸºç±»å’Œå…ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inline.py            # ğŸ”„ æŸ¥è¯¢è·¯ç”±å’Œåˆ†å‘ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ character.py         # ğŸ­ è§’è‰²æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ preset.py            # âš™ï¸ é¢„è®¾æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ help.py              # ğŸ“– å¸®åŠ©æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ default.py           # ğŸ’¡ é»˜è®¤æŸ¥è¯¢å¤„ç†å™¨
â”‚   â””â”€â”€ ğŸ“ public_functions/         # ğŸ”§ å…¬å…±åŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ ğŸ“„ conversation.py      # ğŸ’­ å¯¹è¯ç®¡ç†æ ¸å¿ƒ
â”‚       â”œâ”€â”€ ğŸ“„ config.py            # âš™ï¸ é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ ğŸ“„ decorators.py        # ğŸ¨ è£…é¥°å™¨ï¼ˆæƒé™æ£€æŸ¥ã€æ¶ˆæ¯éªŒè¯ï¼‰
â”‚       â”œâ”€â”€ ğŸ“„ messages.py          # ğŸ“¨ æ¶ˆæ¯å‘é€å’Œæ ¼å¼åŒ–
â”‚       â””â”€â”€ ğŸ“„ error.py             # âŒ é”™è¯¯å¤„ç†
â”œâ”€â”€ ğŸ“ LLM_tools/                    # ğŸ› ï¸ LLM å·¥å…·è°ƒç”¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ğŸ“„ tools.py                 # ğŸ”¨ å·¥å…·å®ç°ï¼ˆå¸‚åœºåˆ†æã€æ•°æ®åº“æŸ¥è¯¢ï¼‰
â”‚   â””â”€â”€ ğŸ“„ tools_registry.py        # ğŸ“‹ å·¥å…·æ³¨å†Œå’Œè°ƒç”¨ç®¡ç†
â”œâ”€â”€ ğŸ“ utils/                        # ğŸ”§ å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ ğŸ“„ LLM_utils.py             # ğŸ§  LLM API å°è£…å’Œå®¢æˆ·ç«¯ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“„ db_utils.py              # ğŸ—„ï¸ æ•°æ®åº“æ“ä½œï¼ˆSQLite è¿æ¥æ± ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ file_utils.py            # ğŸ“‚ æ–‡ä»¶å¤„ç†ï¼ˆé…ç½®ã€è§’è‰²ã€æç¤ºè¯ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ logging_utils.py         # ğŸ“ æ—¥å¿—ç³»ç»Ÿ
â”‚   â””â”€â”€ ğŸ“„ text_utils.py            # ğŸ“ æ–‡æœ¬å¤„ç†å·¥å…·
â”œâ”€â”€ ğŸ“ web/                          # ğŸŒ Web ç®¡ç†åå°
â”‚   â”œâ”€â”€ ğŸ“„ app.py                   # ğŸ–¥ï¸ Flask Web åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“„ database.md              # ğŸ“Š æ•°æ®åº“æ–‡æ¡£
â”‚   â””â”€â”€ ğŸ“ templates/               # ğŸ¨ Web æ¨¡æ¿
â”œâ”€â”€ ğŸ“ config/                       # âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ config.json              # ğŸ”§ ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“„ director_menu.json       # ğŸ¬ å¯¼æ¼”æ¨¡å¼é…ç½®
â”œâ”€â”€ ğŸ“ characters/                   # ğŸ­ è§’è‰²é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ prompts/                      # ğŸ’­ æç¤ºè¯æ¨¡æ¿
â””â”€â”€ ğŸ“ data/                         # ğŸ’¾ æ•°æ®å­˜å‚¨
    â”œâ”€â”€ ğŸ“„ data.db                  # ğŸ—„ï¸ SQLite æ•°æ®åº“
    â””â”€â”€ ğŸ“ pics/                    # ğŸ–¼ï¸ å›¾ç‰‡å­˜å‚¨
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 1. ğŸ“¨ æ¶ˆæ¯å¤„ç†ç³»ç»Ÿ
- **åŒæ¨¡å¼æ”¯æŒ**ï¼šç§èŠå’Œç¾¤èŠæ¶ˆæ¯æ™ºèƒ½è·¯ç”±
- **æ¶ˆæ¯éªŒè¯**ï¼šè¿‡æœŸæ£€æŸ¥ã€ç”¨æˆ·éªŒè¯ã€æƒé™æ§åˆ¶
- **è§¦å‘æœºåˆ¶**ï¼šå…³é”®è¯è§¦å‘ã€@æåŠã€å›å¤æ£€æµ‹
- **è£…é¥°å™¨æ¶æ„**ï¼š`@ensure_user_info_updated`ã€`@check_message_expiration` ç­‰
- **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·å‹å¥½æç¤º

### 2. âš¡ å‘½ä»¤å¤„ç†ç³»ç»Ÿ
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç§èŠã€ç¾¤ç»„ã€ç®¡ç†å‘˜å‘½ä»¤åˆ†ç¦»
- **å…ƒæ•°æ®é©±åŠ¨**ï¼š`CommandMeta` ç±»å®šä¹‰å‘½ä»¤å±æ€§
- **æƒé™æ§åˆ¶**ï¼šç”¨æˆ·ç­‰çº§ã€ç®¡ç†å‘˜æƒé™ã€ç¾¤ç»„æƒé™
- **åŠ¨æ€æ³¨å†Œ**ï¼šè‡ªåŠ¨æ‰«æå’Œæ³¨å†Œå‘½ä»¤å¤„ç†å™¨
- **èœå•ç”Ÿæˆ**ï¼šæ ¹æ®æƒé™åŠ¨æ€ç”Ÿæˆå‘½ä»¤èœå•

### 3. ğŸ­ è§’è‰²ç®¡ç†ç³»ç»Ÿ
- **è§’è‰²åº“**ï¼šé¢„è®¾è§’è‰² + ç”¨æˆ·è‡ªå®šä¹‰è§’è‰²
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šè§’è‰²é…ç½®ã€å¯¹è¯å†å²ã€ç”¨æˆ·åå¥½
- **åˆ‡æ¢æœºåˆ¶**ï¼šæ— ç¼è§’è‰²åˆ‡æ¢ï¼Œè‡ªåŠ¨é‡ç½®å¯¹è¯ä¸Šä¸‹æ–‡
- **ä¸ªæ€§åŒ–**ï¼šæ”¯æŒè§’è‰²æ˜µç§°ã€é—®å€™è¯­ã€è¡Œä¸ºæ¨¡å¼å®šåˆ¶
- **æ–‡ä»¶ç®¡ç†**ï¼šJSON æ ¼å¼è§’è‰²é…ç½®ï¼Œæ”¯æŒå¯¼å…¥å¯¼å‡º

### 4. ğŸ› ï¸ LLM å·¥å…·è°ƒç”¨ç³»ç»Ÿ
- **å·¥å…·æ³¨å†Œè¡¨**ï¼š`MarketToolRegistry`ã€`DatabaseToolRegistry` ç­‰
- **å¼‚æ­¥è°ƒç”¨**ï¼šæ”¯æŒå¹¶å‘å·¥å…·æ‰§è¡Œ
- **ç»“æœæ ¼å¼åŒ–**ï¼šå·¥å…·è¾“å‡ºçš„æ™ºèƒ½æ ¼å¼åŒ–å’Œå±•ç¤º
- **é”™è¯¯å¤„ç†**ï¼šå·¥å…·è°ƒç”¨å¤±è´¥çš„ä¼˜é›…é™çº§
- **æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°å·¥å…·å’ŒåŠŸèƒ½

### 5. ğŸ’¾ æ•°æ®æŒä¹…åŒ–
- **è¿æ¥æ± ç®¡ç†**ï¼šSQLite è¿æ¥æ± ï¼Œæ”¯æŒå¹¶å‘è®¿é—®
- **äº‹åŠ¡å¤„ç†**ï¼šæ•°æ®ä¸€è‡´æ€§ä¿è¯
- **ç”¨æˆ·æ•°æ®**ï¼šä¸ªäººé…ç½®ã€å¯¹è¯å†å²ã€ä½¿ç”¨ç»Ÿè®¡
- **ç¾¤ç»„æ•°æ®**ï¼šç¾¤ç»„é…ç½®ã€æ¶ˆæ¯è®°å½•ã€æƒé™è®¾ç½®
- **å¤‡ä»½æ¢å¤**ï¼šæ•°æ®å¯¼å‡ºå¯¼å…¥åŠŸèƒ½

### 6. ğŸŒ Web ç®¡ç†åå°
- **ç”¨æˆ·ç®¡ç†**ï¼šç”¨æˆ·ä¿¡æ¯æŸ¥çœ‹ã€æƒé™ä¿®æ”¹ã€é¢åº¦ç®¡ç†
- **æ•°æ®ç»Ÿè®¡**ï¼šä½¿ç”¨æƒ…å†µåˆ†æã€çƒ­é—¨åŠŸèƒ½ç»Ÿè®¡
- **ç³»ç»Ÿç›‘æ§**ï¼šå®æ—¶çŠ¶æ€ç›‘æ§ã€æ—¥å¿—æŸ¥çœ‹
- **é…ç½®ç®¡ç†**ï¼šåœ¨çº¿é…ç½®ä¿®æ”¹ã€è§’è‰²ç®¡ç†
- **å®‰å…¨è®¤è¯**ï¼šç™»å½•éªŒè¯ã€ä¼šè¯ç®¡ç†

## å¿«é€Ÿå¼€å§‹

### ä¾èµ–ç¯å¢ƒ
- Python 3.12+
- pip
- Dockerï¼ˆå¯é€‰ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼‰

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### é…ç½®
1. å¤åˆ¶ `config/config.json`ï¼Œå¡«å†™ Telegram Bot Tokenã€API Keysã€ç®¡ç†å‘˜ç­‰ä¿¡æ¯
2. è‡ªå®šä¹‰ `characters/` è§’è‰²é…ç½®
3. ç¼–è¾‘ `prompts/` é¢„è®¾æ–‡ä»¶

### å¯åŠ¨æ–¹å¼

#### æœ¬åœ°è¿è¡Œ
```bash
python bot_run.py
```

#### Docker éƒ¨ç½²
```bash
docker build -t cyber-waifu-bot .
docker run -d --name cyber-waifu-container \
  -v "${PWD}/config:/app/config" \
  -v "${PWD}/prompts:/app/prompts" \
  -v "${PWD}/data:/app/data" \
  -v "${PWD}/characters:/app/characters" \
  cyber-waifu-bot
```

> Windows PowerShell ä¸‹ `${PWD}` è¡¨ç¤ºå½“å‰ç›®å½•ï¼ŒCMD ç”¨ `%CD%`

## ğŸ“– å‘½ä»¤æ‰‹å†Œ

### ğŸ‘¤ ç§èŠå‘½ä»¤

#### ğŸ¯ åŸºç¡€åŠŸèƒ½
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/start` | æ¬¢è¿æ¶ˆæ¯å’ŒåŠŸèƒ½ä»‹ç» | `/start` |
| `/help` | è¯¦ç»†å¸®åŠ©æ–‡æ¡£ | `/help` |
| `/me` | æŸ¥çœ‹ä¸ªäººä¿¡æ¯å’Œä½¿ç”¨ç»Ÿè®¡ | `/me` |
| `/sign` | æ¯æ—¥ç­¾åˆ°è·å–é¢åº¦å¥–åŠ± | `/sign` |

#### ğŸ­ è§’è‰²ç®¡ç†
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/char` | æŸ¥çœ‹å½“å‰è§’è‰²å’Œè§’è‰²åˆ—è¡¨ | `/char` |
| `/newchar [è§’è‰²å]` | åˆ›å»ºè‡ªå®šä¹‰è§’è‰² | `/newchar æˆ‘çš„åŠ©æ‰‹` |
| `/delchar` | åˆ é™¤å·²æœ‰è§’è‰² | `/delchar` |
| `/nick [æ˜µç§°]` | ä¿®æ”¹å½“å‰è§’è‰²æ˜µç§° | `/nick å°åŠ©æ‰‹` |

#### ğŸ’¬ å¯¹è¯ç®¡ç†
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/new` | å¼€å§‹æ–°çš„å¯¹è¯ä¼šè¯ | `/new` |
| `/save [æ ‡é¢˜]` | ä¿å­˜å½“å‰å¯¹è¯ | `/save é‡è¦è®¨è®º` |
| `/load` | åŠ è½½å†å²å¯¹è¯ | `/load` |
| `/delete` | åˆ é™¤æŒ‡å®šå¯¹è¯è®°å½• | `/delete` |
| `/undo` | æ’¤é”€ä¸Šä¸€æ¡æ¶ˆæ¯ | `/undo` |
| `/regen` | é‡æ–°ç”ŸæˆAIå›å¤ | `/regen` |

#### âš™ï¸ è®¾ç½®é…ç½®
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/setting` | ä¸ªäººè®¾ç½®èœå• | `/setting` |
| `/api` | åˆ‡æ¢LLMæ¨¡å‹ | `/api` |
| `/preset` | ç®¡ç†å¯¹è¯é¢„è®¾ | `/preset` |
| `/stream` | åˆ‡æ¢æµå¼è¾“å‡ºæ¨¡å¼ | `/stream` |

#### ğŸ“Š é«˜çº§åŠŸèƒ½
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/c [å¸ç§] [å‚æ•°]` | åŠ å¯†è´§å¸åˆ†æ | `/c btc long` |
| `/crypto [å¸ç§] [å‚æ•°]` | åŠ å¯†è´§å¸åˆ†æï¼ˆå®Œæ•´å‘½ä»¤ï¼‰ | `/crypto ethereum short` |
| `/director` | å¯¼æ¼”æ¨¡å¼ï¼ˆå¤šè§’è‰²å¯¹è¯ï¼‰ | `/director` |
| `/done` | æ ‡è®°ä»»åŠ¡å®Œæˆ | `/done` |

#### ğŸ” å†…è”æŸ¥è¯¢åŠŸèƒ½
| æŸ¥è¯¢æ ¼å¼ | æè¿° | ç¤ºä¾‹ |
|----------|------|------|
| `@botname char [æœç´¢è¯]` | æŸ¥è¯¢å¯ç”¨è§’è‰²åˆ—è¡¨ | `@botname char miku` |
| `@botname preset [æœç´¢è¯]` | æŸ¥è¯¢å¯ç”¨é¢„è®¾åˆ—è¡¨ | `@botname preset nsfw` |
| `@botname help` | è·å–å†…è”æŸ¥è¯¢å¸®åŠ© | `@botname help` |
| `@botname` | æ˜¾ç¤ºåŸºæœ¬ä½¿ç”¨æç¤º | `@botname` |

**åŠ å¯†è´§å¸åˆ†æå‚æ•°è¯´æ˜ï¼š**
- `long` - å¤šå¤´åˆ†æå€¾å‘
- `short` - ç©ºå¤´åˆ†æå€¾å‘  
- æ— å‚æ•° - ä¸­æ€§åˆ†æ

### ğŸ‘¥ ç¾¤ç»„å‘½ä»¤

#### ğŸ› ï¸ ç¾¤ç»„ç®¡ç†ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/remake` | é‡ç½®ç¾¤èŠå¯¹è¯ä¸Šä¸‹æ–‡ | `/remake` |
| `/switch` | åˆ‡æ¢ç¾¤ç»„è§’è‰² | `/switch` |
| `/rate [0-1]` | è®¾ç½®å›å¤æ¦‚ç‡ | `/rate 0.3` |
| `/kw` | ç®¡ç†å…³é”®è¯è§¦å‘ | `/kw` |
| `/e` | å¯ç”¨ç¾¤èŠè¯é¢˜è®¨è®º | `/e` |
| `/d` | ç¦ç”¨ç¾¤èŠè¯é¢˜è®¨è®º | `/d` |

#### ğŸ“Š ç¾¤ç»„åŠŸèƒ½
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/cc [å¸ç§] [å‚æ•°]` | ç¾¤èŠåŠ å¯†è´§å¸åˆ†æ | `/cc btc long` |

### ğŸ” ç®¡ç†å‘˜å‘½ä»¤

| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `/addf [ç”¨æˆ·ID/all] [æ•°é‡]` | å¢åŠ ç”¨æˆ·é¢åº¦ | `/addf 123456 100` |
| `/sett [ç”¨æˆ·ID] [ç­‰çº§]` | ä¿®æ”¹ç”¨æˆ·ç­‰çº§ | `/sett 123456 2` |
| `/q [æŸ¥è¯¢]` | æ•°æ®åº“æŸ¥è¯¢åˆ†æ | `/q æŸ¥çœ‹ç”¨æˆ·ç»Ÿè®¡` |

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

#### 1. æ¨¡å—åŒ–è®¾è®¡
```
bot_core/
â”œâ”€â”€ command_handlers/     # å‘½ä»¤å¤„ç†å±‚
â”‚   â”œâ”€â”€ base.py          # åŸºç±»å’Œå…ƒæ•°æ®ç³»ç»Ÿ
â”‚   â”œâ”€â”€ private.py       # ç§èŠå‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ group.py         # ç¾¤ç»„å‘½ä»¤å®ç°
â”‚   â””â”€â”€ admin.py         # ç®¡ç†å‘˜å‘½ä»¤å®ç°
â”œâ”€â”€ message_handlers/     # æ¶ˆæ¯å¤„ç†å±‚
â”œâ”€â”€ callback_handlers/    # å›è°ƒå¤„ç†å±‚
â””â”€â”€ public_functions/     # å…¬å…±åŠŸèƒ½å±‚
```

#### 2. æ•°æ®è®¿é—®å±‚
```
utils/
â”œâ”€â”€ db_utils.py          # æ•°æ®åº“è¿æ¥æ± å’Œæ“ä½œ
â”œâ”€â”€ LLM_utils.py         # LLMå®¢æˆ·ç«¯ç®¡ç†
â”œâ”€â”€ file_utils.py        # æ–‡ä»¶å’Œé…ç½®ç®¡ç†
â””â”€â”€ logging_utils.py     # æ—¥å¿—ç³»ç»Ÿ
```

#### 3. ä¸šåŠ¡é€»è¾‘å±‚
```
LLM_tools/
â”œâ”€â”€ tools.py             # å·¥å…·å®ç°
â””â”€â”€ tools_registry.py    # å·¥å…·æ³¨å†Œå’Œè°ƒç”¨
```

### ğŸ”§ æ‰©å±•å¼€å‘

#### æ·»åŠ æ–°å‘½ä»¤
```python
# åœ¨ bot_core/command_handlers/ ä¸­åˆ›å»ºæ–°å‘½ä»¤
class MyCommand(BaseCommand):
    meta = CommandMeta(
        name='my_command',
        command_type='private',  # æˆ– 'group', 'admin'
        trigger='mycmd',
        menu_text='æˆ‘çš„å‘½ä»¤',
        show_in_menu=True,
        menu_weight=10,
        bot_admin_required=False  # å¯é€‰çš„æƒé™è¦æ±‚
    )
    
    async def handle(self, update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
        # å‘½ä»¤å¤„ç†é€»è¾‘
        await update.message.reply_text("Hello from my command!")
```

#### æ·»åŠ æ–°å·¥å…·
```python
# åœ¨ LLM_tools/tools.py ä¸­æ·»åŠ å·¥å…·
async def my_tool(param1: str, param2: int) -> str:
    """æˆ‘çš„è‡ªå®šä¹‰å·¥å…·
    
    Args:
        param1: å‚æ•°1æè¿°
        param2: å‚æ•°2æè¿°
        
    Returns:
        å·¥å…·æ‰§è¡Œç»“æœ
    """
    # å·¥å…·é€»è¾‘å®ç°
    return f"ç»“æœ: {param1} - {param2}"

# åœ¨ tools_registry.py ä¸­æ³¨å†Œ
MY_TOOLS = {
    "my_tool": {
        "description": "æˆ‘çš„è‡ªå®šä¹‰å·¥å…·æè¿°",
        "parameters": {
            "param1": {"type": "string", "description": "å‚æ•°1"},
            "param2": {"type": "integer", "description": "å‚æ•°2"}
        }
    }
}
```

#### æ·»åŠ æ–°è§’è‰²
```json
// åœ¨ characters/ ç›®å½•ä¸‹åˆ›å»º my_character.json
{
    "name": "æˆ‘çš„è§’è‰²",
    "description": "è§’è‰²æè¿°",
    "personality": "è§’è‰²æ€§æ ¼è®¾å®š",
    "meeting": "åˆæ¬¡è§é¢çš„é—®å€™è¯­",
    "example_dialogue": [
        {"user": "ç”¨æˆ·ç¤ºä¾‹", "assistant": "è§’è‰²å›å¤ç¤ºä¾‹"}
    ]
}
```

### ğŸ” é”™è¯¯å¤„ç†ä½“ç³»

#### 1. åˆ†å±‚é”™è¯¯å¤„ç†
```python
# å…¨å±€é”™è¯¯å¤„ç†å™¨ (bot_run.py)
async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # å¤„ç†æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸
    
# è£…é¥°å™¨é”™è¯¯å¤„ç† (decorators.py)
@Decorators.ensure_user_info_updated
@Decorators.check_message_expiration
async def message_handler(update, context):
    # æ¶ˆæ¯çº§åˆ«çš„é”™è¯¯å¤„ç†
    
# ä¸šåŠ¡é€»è¾‘é”™è¯¯å¤„ç†
try:
    result = await some_operation()
except SpecificError as e:
    logger.error(f"å…·ä½“é”™è¯¯: {e}")
    await update.message.reply_text("ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º")
```

#### 2. é”™è¯¯ç±»å‹å®šä¹‰
```python
# bot_core/public_functions/error.py
class BotError(Exception):
    """Botè¿è¡Œæ—¶é”™è¯¯åŸºç±»"""
    
class ConfigError(BotError):
    """é…ç½®é”™è¯¯"""
    
class DatabaseError(BotError):
    """æ•°æ®åº“é”™è¯¯"""
```

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–

#### 1. æ•°æ®åº“è¿æ¥æ± 
```python
# utils/db_utils.py
class DatabaseConnectionPool:
    # å•ä¾‹æ¨¡å¼çš„è¿æ¥æ± ç®¡ç†
    # æ”¯æŒå¹¶å‘è®¿é—®å’Œè¿æ¥å¤ç”¨
```

#### 2. LLMå®¢æˆ·ç«¯ç®¡ç†
```python
# utils/LLM_utils.py
class LLMClientManager:
    # å¼‚æ­¥å®¢æˆ·ç«¯æ± 
    # å¹¶å‘æ§åˆ¶å’Œèµ„æºç®¡ç†
```

#### 3. å¼‚æ­¥å¤„ç†
```python
# æ‰€æœ‰I/Oæ“ä½œéƒ½ä½¿ç”¨å¼‚æ­¥
async def handle_message():
    async with llm_client_manager.semaphore:
        # æ§åˆ¶å¹¶å‘æ•°é‡
        result = await llm_client.chat.completions.create(...)
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. **Fork é¡¹ç›®** â†’ åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ â†’ å¼€å‘æµ‹è¯• â†’ æäº¤ PR
2. **ä»£ç è§„èŒƒ**ï¼šéµå¾ª PEP 8ï¼Œä½¿ç”¨ç±»å‹æ³¨è§£
3. **æäº¤è§„èŒƒ**ï¼šæ¸…æ™°çš„æäº¤ä¿¡æ¯ï¼ŒåŠŸèƒ½å®Œæ•´çš„æäº¤
4. **æ–‡æ¡£æ›´æ–°**ï¼šåŒæ­¥æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š

### æµ‹è¯•è¦æ±‚
- æœ¬åœ°æµ‹è¯•æ‰€æœ‰ä¿®æ”¹åŠŸèƒ½
- ç¡®ä¿ä¸ç ´åç°æœ‰åŠŸèƒ½
- æ·»åŠ å¿…è¦çš„é”™è¯¯å¤„ç†
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## â“ å¸¸è§é—®é¢˜

### ğŸ”§ éƒ¨ç½²ç›¸å…³
**Q: å¦‚ä½•è·å– Telegram Bot Tokenï¼Ÿ**
A: è”ç³» [@BotFather](https://t.me/BotFather) åˆ›å»ºæœºå™¨äººå¹¶è·å– Token

**Q: å¦‚ä½•é…ç½® LLM APIï¼Ÿ**
A: åœ¨ `config/config.json` ä¸­é…ç½® API å¯†é’¥å’Œç«¯ç‚¹ï¼Œæ”¯æŒ OpenAIã€Claudeã€Gemini ç­‰

**Q: Docker éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼Ÿ**
A: ç¡®ä¿æŒ‚è½½ `config`ã€`data`ã€`characters`ã€`prompts` ç›®å½•ä»¥æŒä¹…åŒ–æ•°æ®

### ğŸ› æ•…éšœæ’é™¤
**Q: æœºå™¨äººæ— å“åº”æ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥ `data/bot.log` æ—¥å¿—æ–‡ä»¶ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯å’Œç½‘ç»œè¿æ¥çŠ¶æ€

**Q: æ•°æ®åº“é”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ**
A: æ£€æŸ¥ `data/data.db` æ–‡ä»¶æƒé™ï¼Œç¡®ä¿åº”ç”¨æœ‰è¯»å†™æƒé™

**Q: ç¾¤ç»„ä¸­æœºå™¨äººä¸å›å¤ï¼Ÿ**
A: ç¡®ä¿æœºå™¨äººæœ‰ç¾¤ç»„æ¶ˆæ¯æƒé™ï¼Œæ£€æŸ¥å…³é”®è¯è®¾ç½®å’Œå›å¤é¢‘ç‡é…ç½®

### ğŸ¯ åŠŸèƒ½ä½¿ç”¨
**Q: å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰è§’è‰²ï¼Ÿ**
A: ä½¿ç”¨ `/newchar è§’è‰²å` å‘½ä»¤ï¼Œç„¶åæŒ‰æç¤ºè¾“å…¥è§’è‰²è®¾å®š

**Q: åŠ å¯†è´§å¸åˆ†ææ”¯æŒå“ªäº›å¸ç§ï¼Ÿ**
A: æ”¯æŒä¸»æµåŠ å¯†è´§å¸ï¼Œå¦‚ BTCã€ETHã€BNB ç­‰ï¼Œä½¿ç”¨å¸ç§ç¬¦å·æˆ–å…¨å

**Q: å¦‚ä½•å¤‡ä»½å¯¹è¯æ•°æ®ï¼Ÿ**
A: å®šæœŸå¤‡ä»½ `data/data.db` æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ Web åå°çš„å¯¼å‡ºåŠŸèƒ½

## ğŸš€ æœªæ¥è§„åˆ’
- [ ] ğŸ”Š **è¯­éŸ³æ”¯æŒ**ï¼šè¯­éŸ³æ¶ˆæ¯è¯†åˆ«å’Œåˆæˆ
- [ ] ğŸ“Š **é«˜çº§åˆ†æ**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æå’Œä¸ªæ€§åŒ–æ¨è
- [ ] ğŸŒ **åˆ†å¸ƒå¼éƒ¨ç½²**ï¼šæ”¯æŒå¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- [ ] ğŸ® **æ¸¸æˆåŒ–åŠŸèƒ½**ï¼šç§¯åˆ†ç³»ç»Ÿã€æˆå°±ç³»ç»Ÿ
- [ ] ğŸ¤ **ç¤¾åŒºåŠŸèƒ½**ï¼šç”¨æˆ·é—´çš„è§’è‰²åˆ†äº«å’Œäº¤æµ

## ğŸ“ æ”¯æŒä¸åé¦ˆ

- ğŸ› **Bug æŠ¥å‘Š**ï¼š[GitHub Issues](https://github.com/your-repo/issues)
- ğŸ’¡ **åŠŸèƒ½å»ºè®®**ï¼š[GitHub Discussions](https://github.com/your-repo/discussions)
- ğŸ“§ **è”ç³»å¼€å‘è€…**ï¼š[@Xi_cuicui](https://t.me/Xi_cuicui)
- ğŸ“– **é¡¹ç›®æ–‡æ¡£**ï¼š[Wiki](https://github.com/your-repo/wiki)

---

â­ **å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒä¸€ä¸‹ï¼**

ğŸ’– **æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼**
